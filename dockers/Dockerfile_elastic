# Use the official Elasticsearch image as a base image
FROM docker.elastic.co/elasticsearch/elasticsearch:8.6.0

# Install Python and pip to run the script
USER root
RUN apt-get update && apt-get install -y python3 python3-pip

# Install the required Elasticsearch client for Python
RUN pip3 install elasticsearch

# Copy your existing Python code (the one you provided) into the container
COPY elasticsearch_client.py /usr/local/bin/elasticsearch_client.py

# Set environment variables
ENV discovery.type=single-node
ENV xpack.security.enabled=false
ENV xpack.security.transport.ssl.enabled=false

# Expose ports
EXPOSE 9200 9300

# Start Elasticsearch and run your Python script
CMD ["sh", "-c", "/usr/share/elasticsearch/bin/elasticsearch & python3 /usr/local/bin/elasticsearch_client.py && tail -f /dev/null"]
